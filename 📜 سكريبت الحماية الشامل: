#!/bin/bash

# ğŸ›¡ï¸ Security Protection & Cleanup Script
# Author: Security Team
# Version: 2.0

echo "ğŸ” Starting Security Enhancement..."

# ==========================================
# ğŸ“± SYSTEM SECURITY CHECKS
# ==========================================

echo "ğŸ“Š System Analysis..."

# Check running processes
echo "Active processes:" > security_report.txt
ps aux | grep -E "(suspicious|malware|adware)" >> security_report.txt

# Network connections
echo -e "\nNetwork connections:" >> security_report.txt
netstat -tuln >> security_report.txt

# Package list
echo -e "\nInstalled packages:" >> security_report.txt
pm list packages | head -20 >> security_report.txt

# ==========================================
# ğŸ§¹ SYSTEM CLEANUP
# ==========================================

echo "ğŸ§¹ Starting cleanup..."

# Clear cache
sync
echo 3 > /proc/sys/vm/drop_caches 2>/dev/null || echo "Cache clear requires root"

# Temp files cleanup
find /tmp -type f -mtime +7 -delete 2>/dev/null
find /var/tmp -type f -mtime +7 -delete 2>/dev/null

# ==========================================
# ğŸ”’ SECURITY HARDENING
# ==========================================

echo "ğŸ”’ Applying security settings..."

# Disable suspicious services
SUSPICIOUS_PACKAGES=(
    "com.dti.samsung"
    "com.digitalturbine"
    "com.adware"
    "com.malware"
)

for pkg in "${SUSPICIOUS_PACKAGES[@]}"; do
    pm disable-user --user 0 "$pkg" 2>/dev/null && echo "Disabled: $pkg"
done

# ==========================================
# ğŸŒ NETWORK SECURITY
# ==========================================

echo "ğŸŒ Network security scan..."

# Port scan check
nmap -sS localhost 2>/dev/null | grep -E "(open|filtered)" >> security_report.txt

# DNS check
echo -e "\nDNS Configuration:" >> security_report.txt
cat /etc/resolv.conf >> security_report.txt 2>/dev/null

# ==========================================
# ğŸ“Š SECURITY AUDIT
# ==========================================

echo "ğŸ“Š Generating security audit..."

# Check permissions
echo -e "\nDangerous permissions:" >> security_report.txt
pm list packages -3 | while read package; do
    pkg_name=$(echo $package | cut -d: -f2)
    dumpsys package $pkg_name | grep -E "(CAMERA|MICROPHONE|LOCATION|SMS)" | head -3
done >> security_report.txt

# Battery usage analysis
echo -e "\nBattery usage:" >> security_report.txt
dumpsys batterystats | grep -E "Uid|Wake" | head -10 >> security_report.txt

# ==========================================
# ğŸš€ PERFORMANCE OPTIMIZATION
# ==========================================

echo "ğŸš€ Optimizing performance..."

# Kill background apps
am kill-all

# Optimize memory
echo "Memory optimization..." >> security_report.txt
cat /proc/meminfo | grep -E "(MemTotal|MemFree|Cached)" >> security_report.txt

# ==========================================
# ğŸ” FIREWALL RULES
# ==========================================

echo "ğŸ” Setting up firewall rules..."

# Create iptables rules (requires root)
FIREWALL_RULES=(
    "INPUT -p tcp --dport 22 -j ACCEPT"
    "INPUT -p tcp --dport 80 -j ACCEPT" 
    "INPUT -p tcp --dport 443 -j ACCEPT"
    "INPUT -j DROP"
    "OUTPUT -j ACCEPT"
)

for rule in "${FIREWALL_RULES[@]}"; do
    iptables -A $rule 2>/dev/null && echo "Added rule: $rule"
done

# ==========================================
# ğŸ“± APP SECURITY SCAN
# ==========================================

echo "ğŸ“± Scanning applications..."

# Check for suspicious apps
MALWARE_SIGNATURES=(
    "adware"
    "spyware" 
    "trojan"
    "backdoor"
    "cryptominer"
)

for sig in "${MALWARE_SIGNATURES[@]}"; do
    pm list packages | grep -i "$sig" >> security_report.txt
done

# ==========================================
# ğŸ›¡ï¸ KNOX SECURITY (Samsung)
# ==========================================

echo "ğŸ›¡ï¸ Knox security check..."

# Check Knox status
dumpsys device_policy | grep -E "(Knox|Security)" >> security_report.txt

# ==========================================
# ğŸ“‹ FINAL REPORT
# ==========================================

echo "ğŸ“‹ Generating final report..."

cat << EOF >> security_report.txt

==========================================
ğŸ” SECURITY RECOMMENDATIONS:
==========================================

1. âœ… Enable 2FA on all accounts
2. ğŸ”’ Use strong passwords (12+ chars)
3. ğŸŒ Use secure DNS (1.1.1.1)
4. ğŸ“± Keep apps updated
5. ğŸ›¡ï¸ Enable Knox Security
6. ğŸ”¥ Use firewall apps
7. ğŸš« Disable unused services
8. ğŸ“Š Regular security scans

==========================================
ğŸ§¹ CLEANUP COMPLETED:
==========================================

âœ… Cache cleared
âœ… Temp files removed
âœ… Suspicious apps disabled
âœ… Network secured
âœ… Permissions audited
âœ… Performance optimized

==========================================
EOF

echo "ğŸ‰ Security enhancement completed!"
echo "ğŸ“„ Check security_report.txt for details"

# Set proper permissions
chmod 600 security_report.txt

echo "ğŸ” Stay secure! ğŸ›¡ï¸"
